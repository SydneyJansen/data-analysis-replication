---
title: "Untitled"
author: "Sydney Jansen"
date: "2024-03-25"
output: html_document
---

```{r setup, include=FALSE}
# These are some {knitr} options I typically use to format my **RMarkdown** documents in a consistent way. You should feel free to alter these or use other "chunk options" as you see fit!
# Sometimes, for example, you might want to suppress warnings or messages, and that behavior can be set for specific code chunks individually in the chunk header, e.g., ```{r warning = FALSE, echo = FALSE}

knitr::opts_chunk$set(echo = TRUE)

```

## Introduction
Objective: To investigate vocal plasticity in the tokay gecko (Gekko gecko) by determining if the geckos adjusted the properties of their calls in response to changes in background noise. {the first evidence for vocal plasticity in a reptile}

Methods: The researchers recorded advertisement calls of captive-bred male tokay geckos under different noise conditions and analyzed the duration and amplitude of different call types. 6 males were placed in a sound-chamber with opposing speakers: white noise encapsulating their hearing range and their calls recorded for 4 days. During the recording session, 24 h periods of broadcast noise were alternated with 24 h periods of silence.

Results: Geckos increased the duration of their call syllables in response to noise, but did not adjust the amplitude of their calls. Instead, they produced more high-amplitude syllables and fewer low-amplitude syllables in noise. This demonstrated that the geckos were able to increase the overall signal-to-noise ratio of their calls without using the Lombard effect. In other words, the geckos traded the number of low-amplitude and high-amplitude syllables in each call series to produce more of the louder notes in noise, rather than increasing the amplitude of all components of their call. 

#Load packages
```{r message=FALSE}
library(tidyverse)
library(knitr)
library(ggplot2)
library(ggpubr)
library(dplyr)
library(broom)
library(jmuOutlier)
library(infer)
library(mosaic)
library(coin)

```
#Load in Data: Raw Data from 6 individuals of treatment, series, type, duration, and amplitude. They did not modify the provided dataset, but R added NAs in duration, so we are removing those. 

```{r }
#This worked the entire time until i cleared the environment
#f<- "https://github.com/SydneyJansen/data-analysis-replication/blob/main/data/rawdata.csv"
#data<- read.csv(f, header = TRUE)
f<-"C:/Users/Wildc/OneDrive/Desktop/Data Analysis Class/data-analysis-replication/data/rawdata.csv"
data<- read.csv(f, header = TRUE)  
#They did not modify the provided dataset, but R added NAs in duration, so we are removing those. 
data <- data |>  filter(!is.na(duration))
#View data
head(data)
names(data)
print(data)
## I am Log-transforming a variable
#data_clean$log_variable <- log(data_clean$variable)


```


## Visualization of Data

There were not enough graphs and too much information in the "bubble graph", so I am replicating Figure 2 which shows changes in tokay call parameters in relation to background noise/Grand averages (medians and interquartile ranges) of (a) GECK-note duration. The x axis compares noise to no noise (treatment: noise (1), no noise (0)) and the y axis is the miliseconds of call duration. They used a Sliding scale percent probability ranges chart. 

Figure 2: Grand averages (medians and interquartile ranges) of (a) GECK-note duration with the bars denoting the confidence level. 

```{r out.width="400px", fig.cap="Figure 2 a"}
knitr::include_graphics("https://github.com/SydneyJansen/data-analysis-replication/blob/main/images/fig2.png")
```

```{r }

# Filter the data for treatment GECK=2
datafig2 <- filter(data, type == 2)

bootstrap_stats <- function(datafig2, n_samples = 1000) {
  bootstrap_results <- tibble(
    boot_median = numeric(n_samples),
    boot_q1 = numeric(n_samples),
    boot_q3 = numeric(n_samples)
  )
  
  for (i in 1:n_samples) {
    boot_sample <- sample_n(datafig2, size = n(), replace = TRUE)
    bootstrap_results[i, ] <- boot_sample %>%
      summarize(
        boot_median = median(duration),
        boot_q1 = quantile(duration, probs = 0.25),
        boot_q3 = quantile(duration, probs = 0.75)
      )
  }
  
  return(bootstrap_results)
}


# Permute the data and calculate bootstrap statistics
permuted_data <- datafig2 |>
  filter(type == 2) |>
  group_by(treatment) |>
  do(bootstrap_stats(., n_samples = 1000))

# Create a ggplot object
my_plot <- ggplot(permuted_data, aes(x = factor(treatment))) +
  
  # Add error bar lines for bootstrapped quartiles with end caps
  geom_linerange(
    aes(ymin = boot_q1, ymax = boot_q3),
    color = "black",
    size = 1.5,
    position = position_dodge(width = 0.5)
  ) +
  
  # Add mean as a single point
  stat_summary(
    fun = mean, 
    geom = "point", 
    aes(y = boot_median),
    color = "black", 
    size = 3,
    position = position_dodge(width = 0.5)
  ) +
  
  # Add labels to axes and title
  labs(x = "No Noise                                  Noise", y = "Call Duration (ms)", title = "GECK") +
  
  # Customize theme
  theme_minimal()

# Save the plot as an image file
ggsave("fig2.png", plot = my_plot, width = 8, height = 6, units = "in", dpi = 300)

#I have no idea why the plot in the OG is 80-155
```

```{r echo=FALSE}
knitr::include_graphics("images/file.png")
```

## Statistical Replications/Reanalysis

Inferential statistical analysis:
Methods: I plan to replicate a linear mixed models (LMMs) from the *R* package `{lme4}` that was used to investigate the treatment effects (noise vs. no noise) on duration of calls. The individual gecko and the call series were included as random effects to account for the repeated measures design of the experiment. There was no more detailed information about R coding in this regard. 

Results: Our analysis of GECK and O notes reveals that the lizards increased the duration of their call syllables in noise (figure 2a,b). GECK notes produced in noise were 7% longer on average than those uttered in the control condition (x21 = 4.367, p = 0.05), and O notes were 37% longer (x21 = 50.059, p = 0.001).The authors used linear mixed models (LMMs) The effect of the treatment (noise/no noise) on amplitude, duration, and the  number of  call types  was examined  with separate models in R using the package lme4. In each model the individual and the call series were fitted as random effects to control for the repeated measures design. The treatment effects on amplitude and duration were investigated with linear mixed models(LMMs), model residuals were checked visually.

What I intend to replicate: What I intend to replicate: I plan to replicate a linear mixed models (LMMs) from the *R* package `{lme4}` that was used to investigate the treatment effects (noise vs. no noise) on duration of calls. The individual gecko and the call series were included as random effects to account for the repeated measures design of the experiment. There was no more detailed information about R coding in this regard. 
Results: Our analysis of GECK and O notes reveals that the lizards increased the duration of their call syllables in noise (figure 2a,b). GECK notes produced in noise were 7% longer on average than those uttered in the control condition (x21 = 4.367, p = 0.05), and O notes were 37% longer (x21 = 50.059, p = 0.001).Results: Our analysis of GECK and O notes reveals that the lizards increased the duration of their call syllables in noise (figure 2a,b). GECK notes produced in noise were 7% longer on average than those uttered in the control condition (x21 = 4.367, p = 0.05), and O notes were 37% longer (x21 = 50.059, p = 0.001).

Replication: 


The relationship between the number of cackle calls and the number of GECK-O syllables in a call series was investigated with Spearman rank correlations (using SPSS Statistics 21). This was done with two data sets: (i) across all males that produced at least five call series, from each of these (n¼5 males) we randomly selected five call series independent of the treatment,and (ii) within the one male from which we recorded the highest number of calls (n¼254 calls)
The authors used alinear mixed models (LMMs) and generalized linear mixed models (GLMMs) to examine the effects of the noise treatment on various call parameters, such as amplitude, duration, and the number of call types. ​ They also used likelihood ratio tests to compare models including the treatment to null models.

[Be sure to **thoroughly** explain what replications you are doing and comment your code so that it is easy for a reader to understand. Include in this section relevant tables/figures/values from the original paper for comparison to what you accomplished with your replication. Note that I want you to do the bulk of any *exposition* using text and markdown syntax outside of code blocks. That is, your document should not just be one big code block with ***R*** style comments but rather a nicely formatted report with code separated from exposition, interpretation, and dicussion.]

In each model the individual and the call series were fitted as random effects to control for the repeated measures design. The treatment effects on amplitude and duration were investigated with linear mixed models (LMMs), model residuals were checked visually.

Descriptive statistical analysis (summarizing and describing the primary properties of a dataset):
Counting Different Call Types and Measuring Their Amplitude: This involves basic descriptive analysis, where the researchers counted the occurrences of different vocalization types and measured their amplitude to describe the vocal behavior of tokay geckos.
Measurement of Call Durations: Measuring and comparing the durations of GECK and O notes under different noise conditions also fall under descriptive analysis. It provides a straightforward description of how call durations vary with environmental noise.


```{}
# Load dplyr for data manipulation
library(dplyr)

# Basic descriptive statistics for amplitude by noise condition
dataset %>%
  group_by(noise_condition) %>%
  summarize(mean_amplitude = mean(amplitude, na.rm = TRUE),
            sd_amplitude = sd(amplitude, na.rm = TRUE),
            n = n())

```




```{r }
library(lme4)
#  log-transformed
logdata <- lmer(data = data, animal ~ treatment + series + type + duration + amplitude + (1|PairID), REML = FALSE)
# Check if the data fit the assumptions using the ggResidpanel package:
resid_panel(model1) # the histogram looks bad; lots of weight in the center and not normally distributed.
# Make a log version of Used_Material:
data$log_Used_Material <- log(data$Used_Material)
# Try the model again using the log_Used_Material.
model2 <- lmer(data = data, log_Used_Material ~ Experience + Nest_No + Time_Taken + (1|PairID), REML = FALSE)
# And check again with ggResidpanel:
resid_panel(model2) # the histogram looks much better now!
# The values are closer to the results! Same p-value!
model_summary <- summary(model2)
print(model_summary)
# LMM for call amplitude or duration as a function of noise condition, with random intercepts for individual
lmm_result <- lmer(amplitude ~ noise_condition + (1|individual), data = dataset)
summary(lmm_result)

# GLMM for count data (e.g., number of call types) with a Poisson distribution
glmm_result <- glmer(num_call_types ~ noise_condition + (1|individual), data = dataset, family = "poisson")
summary(glmm_result)


```
Descriptive statistical analysis:

Methods: 

Results: 

What I intend to replicate: 

Replication:

```{r }

```

## Summary/Discussion

[Narrative section that overviews how successful were you at replicating the analyses and visualizations in the study. What problems did you encounter? Why might you have encountered those problems? What details were lacking from the original study's methods that might have hampered your ability to replicate the authors' results?]

## References
Brumm H, Zollinger SA. 2017 Vocal plasticity in a reptile. Proc. R. Soc. B 284: 20170451.http://dx.doi.org/10.1098/rspb.2017.0451




```{r }

```
